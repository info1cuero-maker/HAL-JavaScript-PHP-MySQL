<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–î–æ–¥–∞—Ç–∏ –∫–æ–º–ø–∞–Ω—ñ—é - HAL</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="assets/css/style.css">
    <style>
        .add-form-container {
            max-width: 900px;
            margin: 0 auto;
        }
        .add-form {
            background: var(--bg-white);
            padding: 2rem;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-md);
        }
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        @media (max-width: 768px) {
            .form-row {
                grid-template-columns: 1fr;
            }
        }
        .form-section {
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--border);
        }
        .form-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        .section-title-small {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        .required-note {
            color: var(--text-gray);
            font-size: 0.875rem;
            margin-bottom: 1.5rem;
        }
        .required-note span {
            color: #ef4444;
        }
        /* Image upload styles */
        .image-upload-area {
            border: 2px dashed var(--border);
            border-radius: var(--radius-lg);
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            margin-bottom: 1rem;
        }
        .image-upload-area:hover {
            border-color: var(--primary);
            background: rgba(59, 130, 246, 0.05);
        }
        .image-upload-area.dragover {
            border-color: var(--primary);
            background: rgba(59, 130, 246, 0.1);
        }
        .image-upload-icon {
            font-size: 3rem;
            margin-bottom: 0.5rem;
        }
        .image-upload-text {
            color: var(--text-gray);
            margin-bottom: 0.5rem;
        }
        .image-upload-hint {
            color: var(--text-light);
            font-size: 0.75rem;
        }
        .uploaded-images {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 0.75rem;
            margin-top: 1rem;
        }
        @media (max-width: 768px) {
            .uploaded-images {
                grid-template-columns: repeat(3, 1fr);
            }
        }
        .uploaded-image {
            position: relative;
            aspect-ratio: 1;
            border-radius: var(--radius);
            overflow: hidden;
        }
        .uploaded-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .uploaded-image .remove-btn {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            background: #ef4444;
            color: white;
            border: none;
            cursor: pointer;
            font-size: 1rem;
            line-height: 1;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .uploaded-image.main::after {
            content: '‚òÖ –ì–æ–ª–æ–≤–Ω–µ';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(to right, var(--primary), var(--secondary));
            color: white;
            font-size: 0.625rem;
            padding: 0.25rem;
            text-align: center;
        }
        .images-count {
            text-align: right;
            font-size: 0.875rem;
            color: var(--text-gray);
        }
        /* SEO section */
        .seo-section {
            background: #f0f9ff;
            border-radius: var(--radius);
            padding: 1.5rem;
        }
        .seo-preview {
            background: white;
            border: 1px solid var(--border);
            border-radius: var(--radius);
            padding: 1rem;
            margin-top: 1rem;
        }
        .seo-preview-title {
            color: #1a0dab;
            font-size: 1.125rem;
            margin-bottom: 0.25rem;
        }
        .seo-preview-url {
            color: #006621;
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }
        .seo-preview-desc {
            color: #545454;
            font-size: 0.875rem;
        }
        .char-counter {
            font-size: 0.75rem;
            color: var(--text-light);
            text-align: right;
            margin-top: 0.25rem;
        }
        .char-counter.warning {
            color: #f59e0b;
        }
        .char-counter.error {
            color: #ef4444;
        }
        /* Auth required notice */
        .auth-required {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            border-radius: var(--radius-lg);
            padding: 2rem;
            text-align: center;
            margin-bottom: 2rem;
        }
        .auth-required h2 {
            margin-bottom: 1rem;
        }
        .auth-required p {
            color: var(--text-gray);
            margin-bottom: 1.5rem;
        }
        .auth-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container header-inner">
            <a href="/" class="logo">HAL</a>
            <nav class="nav">
                <a href="/" class="nav-link">–ì–æ–ª–æ–≤–Ω–∞</a>
                <a href="/search" class="nav-link">–ü–æ—à—É–∫</a>
                <a href="/blog" class="nav-link">–ë–ª–æ–≥</a>
            </nav>
            <div class="nav-actions">
                <div class="lang-switch">
                    <button class="lang-btn active" data-lang="uk">UA</button>
                    <button class="lang-btn" data-lang="ru">RU</button>
                </div>
                <div class="auth-links" id="auth-links">
                    <a href="/login" class="btn btn-outline">–£–≤—ñ–π—Ç–∏</a>
                </div>
            </div>
        </div>
    </header>

    <main class="page-content">
        <div class="container add-form-container">
            <h1 class="section-title mb-4">–î–æ–¥–∞—Ç–∏ –∫–æ–º–ø–∞–Ω—ñ—é</h1>
            
            <!-- Auth Required Notice -->
            <div class="auth-required" id="auth-required" style="display: none;">
                <h2>üîê –î–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ–º–ø–∞–Ω—ñ—ó –ø–æ—Ç—Ä—ñ–±–Ω–∞ —Ä–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</h2>
                <p>–ó–∞—Ä–µ—î—Å—Ç—Ä—É–π—Ç–µ—Å—è –∞–±–æ —É–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± –¥–æ–¥–∞—Ç–∏ —Å–≤–æ—é –∫–æ–º–ø–∞–Ω—ñ—é –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É HAL</p>
                <div class="auth-buttons">
                    <a href="/login?redirect=/add-business" class="btn btn-outline">–£–≤—ñ–π—Ç–∏</a>
                    <a href="/register?redirect=/add-business" class="btn btn-primary">–ó–∞—Ä–µ—î—Å—Ç—Ä—É–≤–∞—Ç–∏—Å—è</a>
                </div>
            </div>
            
            <!-- Add Company Form -->
            <div class="add-form" id="add-form" style="display: none;">
                <p class="required-note">–ü–æ–ª—è –ø–æ–∑–Ω–∞—á–µ–Ω—ñ <span>*</span> –æ–±–æ–≤'—è–∑–∫–æ–≤—ñ –¥–ª—è –∑–∞–ø–æ–≤–Ω–µ–Ω–Ω—è</p>
                
                <form id="add-company-form">
                    <!-- Basic Info -->
                    <div class="form-section">
                        <div class="section-title-small">üìù –û—Å–Ω–æ–≤–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">–ù–∞–∑–≤–∞ –∫–æ–º–ø–∞–Ω—ñ—ó (UA) <span style="color:#ef4444">*</span></label>
                                <input type="text" class="form-input" name="name" id="name" required maxlength="255">
                            </div>
                            <div class="form-group">
                                <label class="form-label">–ù–∞–∑–≤–∞ –∫–æ–º–ø–∞–Ω—ñ—ó (RU) <span style="color:#ef4444">*</span></label>
                                <input type="text" class="form-input" name="name_ru" id="name_ru" required maxlength="255">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">–û–ø–∏—Å (UA) <span style="color:#ef4444">*</span></label>
                            <textarea class="form-textarea" name="description" id="description" rows="4" required maxlength="5000" placeholder="–†–æ–∑–∫–∞–∂—ñ—Ç—å –ø—Ä–æ –≤–∞—à—É –∫–æ–º–ø–∞–Ω—ñ—é, –ø–æ—Å–ª—É–≥–∏ —Ç–∞ –ø–µ—Ä–µ–≤–∞–≥–∏..."></textarea>
                        </div>

                        <div class="form-group">
                            <label class="form-label">–û–ø–∏—Å (RU) <span style="color:#ef4444">*</span></label>
                            <textarea class="form-textarea" name="description_ru" id="description_ru" rows="4" required maxlength="5000"></textarea>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">–ö–∞—Ç–µ–≥–æ—Ä—ñ—è <span style="color:#ef4444">*</span></label>
                                <select class="form-input" name="category_id" id="category_id" required>
                                    <option value="">–û–±–µ—Ä—ñ—Ç—å –∫–∞—Ç–µ–≥–æ—Ä—ñ—é</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">–ú—ñ—Å—Ç–æ <span style="color:#ef4444">*</span></label>
                                <input type="text" class="form-input" name="city" id="city" value="–ö–∏—ó–≤" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">–ê–¥—Ä–µ—Å–∞ <span style="color:#ef4444">*</span></label>
                            <input type="text" class="form-input" name="address" id="address" required placeholder="–≤—É–ª. –•—Ä–µ—â–∞—Ç–∏–∫, 1">
                        </div>
                    </div>

                    <!-- Contact Info -->
                    <div class="form-section">
                        <div class="section-title-small">üìû –ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">–¢–µ–ª–µ—Ñ–æ–Ω <span style="color:#ef4444">*</span></label>
                                <input type="tel" class="form-input" name="phone" id="phone" required placeholder="+380 44 123 4567">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Email <span style="color:#ef4444">*</span></label>
                                <input type="email" class="form-input" name="email" id="email" required placeholder="info@company.com">
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">–í–µ–±-—Å–∞–π—Ç</label>
                            <input type="url" class="form-input" name="website" id="website" placeholder="https://yourcompany.com">
                        </div>
                    </div>

                    <!-- Images -->
                    <div class="form-section">
                        <div class="section-title-small">üñºÔ∏è –ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–æ–º–ø–∞–Ω—ñ—ó <span style="color:#ef4444">*</span></div>
                        <p style="color: var(--text-gray); font-size: 0.875rem; margin-bottom: 1rem;">
                            –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –¥–æ 10 —Ñ–æ—Ç–æ–≥—Ä–∞—Ñ—ñ–π –≤–∞—à–æ—ó –∫–æ–º–ø–∞–Ω—ñ—ó. <strong>–¢—ñ–ª—å–∫–∏ —Ñ–æ—Ä–º–∞—Ç WebP!</strong>
                        </p>
                        
                        <div class="image-upload-area" id="image-upload-area">
                            <input type="file" id="image-input" accept=".webp,image/webp" multiple style="display: none;">
                            <div class="image-upload-icon">üì∑</div>
                            <div class="image-upload-text">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∞–±–æ –ø–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å —Ñ–∞–π–ª–∏ —Å—é–¥–∏</div>
                            <div class="image-upload-hint">–¢—ñ–ª—å–∫–∏ WebP —Ñ–æ—Ä–º–∞—Ç ‚Ä¢ –ú–∞–∫—Å–∏–º—É–º 10 —Ñ–∞–π–ª—ñ–≤ ‚Ä¢ –î–æ 5 –ú–ë –∫–æ–∂–µ–Ω</div>
                        </div>
                        
                        <div class="uploaded-images" id="uploaded-images"></div>
                        <div class="images-count" id="images-count"></div>
                    </div>

                    <!-- SEO Section -->
                    <div class="form-section">
                        <div class="section-title-small">üîç SEO –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è <span style="color:#ef4444">*</span></div>
                        <p style="color: var(--text-gray); font-size: 0.875rem; margin-bottom: 1rem;">
                            –¶—ñ –ø–æ–ª—è –¥–æ–ø–æ–º–æ–∂—É—Ç—å –≤–∞—à—ñ–π –∫–æ–º–ø–∞–Ω—ñ—ó –∫—Ä–∞—â–µ —ñ–Ω–¥–µ–∫—Å—É–≤–∞—Ç–∏—Å—è –≤ –ø–æ—à—É–∫–æ–≤–∏—Ö —Å–∏—Å—Ç–µ–º–∞—Ö (Google, Bing —Ç–æ—â–æ)
                        </p>
                        
                        <div class="seo-section">
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">SEO –ó–∞–≥–æ–ª–æ–≤–æ–∫ (UA) <span style="color:#ef4444">*</span></label>
                                    <input type="text" class="form-input" name="meta_title_uk" id="meta_title_uk" required maxlength="70" placeholder="–ù–∞–∑–≤–∞ –∫–æ–º–ø–∞–Ω—ñ—ó - –ø–æ—Å–ª—É–≥–∏ –≤ –º—ñ—Å—Ç—ñ">
                                    <div class="char-counter" id="meta_title_uk_counter">0 / 60 —Å–∏–º–≤–æ–ª—ñ–≤</div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">SEO –ó–∞–≥–æ–ª–æ–≤–æ–∫ (RU) <span style="color:#ef4444">*</span></label>
                                    <input type="text" class="form-input" name="meta_title_ru" id="meta_title_ru" required maxlength="70">
                                    <div class="char-counter" id="meta_title_ru_counter">0 / 60 —Å–∏–º–≤–æ–ª—ñ–≤</div>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">SEO –û–ø–∏—Å (UA) <span style="color:#ef4444">*</span></label>
                                    <textarea class="form-textarea" name="meta_description_uk" id="meta_description_uk" rows="2" required maxlength="170" placeholder="–ö–æ—Ä–æ—Ç–∫–∏–π –æ–ø–∏—Å –≤–∞—à–æ—ó –∫–æ–º–ø–∞–Ω—ñ—ó –¥–ª—è –ø–æ—à—É–∫–æ–≤–∏—Ö —Å–∏—Å—Ç–µ–º..."></textarea>
                                    <div class="char-counter" id="meta_description_uk_counter">0 / 160 —Å–∏–º–≤–æ–ª—ñ–≤</div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">SEO –û–ø–∏—Å (RU) <span style="color:#ef4444">*</span></label>
                                    <textarea class="form-textarea" name="meta_description_ru" id="meta_description_ru" rows="2" required maxlength="170"></textarea>
                                    <div class="char-counter" id="meta_description_ru_counter">0 / 160 —Å–∏–º–≤–æ–ª—ñ–≤</div>
                                </div>
                            </div>

                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">–ö–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞ (UA) <span style="color:#ef4444">*</span></label>
                                    <input type="text" class="form-input" name="meta_keywords_uk" id="meta_keywords_uk" required maxlength="255" placeholder="–ø–æ—Å–ª—É–≥–∏, –∫–æ–º–ø–∞–Ω—ñ—è, –º—ñ—Å—Ç–æ, –∫–∞—Ç–µ–≥–æ—Ä—ñ—è">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">–ö–ª—é—á–æ–≤—ñ —Å–ª–æ–≤–∞ (RU) <span style="color:#ef4444">*</span></label>
                                    <input type="text" class="form-input" name="meta_keywords_ru" id="meta_keywords_ru" required maxlength="255">
                                </div>
                            </div>
                            
                            <!-- SEO Preview -->
                            <div class="seo-preview">
                                <div style="font-size: 0.75rem; color: var(--text-light); margin-bottom: 0.5rem;">–ü–æ–ø–µ—Ä–µ–¥–Ω—ñ–π –ø–µ—Ä–µ–≥–ª—è–¥ –≤ Google:</div>
                                <div class="seo-preview-title" id="seo-preview-title">–ù–∞–∑–≤–∞ –≤–∞—à–æ—ó –∫–æ–º–ø–∞–Ω—ñ—ó - HAL</div>
                                <div class="seo-preview-url">hal.in.ua ‚Ä∫ company ‚Ä∫ <span id="seo-preview-url">your-company</span></div>
                                <div class="seo-preview-desc" id="seo-preview-desc">–û–ø–∏—Å –≤–∞—à–æ—ó –∫–æ–º–ø–∞–Ω—ñ—ó –∑'—è–≤–∏—Ç—å—Å—è —Ç—É—Ç...</div>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-lg" style="width: 100%" id="submit-btn">
                        ‚úì –î–æ–¥–∞—Ç–∏ –∫–æ–º–ø–∞–Ω—ñ—é
                    </button>
                </form>
            </div>
        </div>
    </main>

    <script src="assets/js/app.js"></script>
    <script>
        // State
        let uploadedImages = [];
        
        // Check auth
        function checkAuth() {
            if (!HAL.state.user) {
                document.getElementById('auth-required').style.display = 'block';
                document.getElementById('add-form').style.display = 'none';
            } else {
                document.getElementById('auth-required').style.display = 'none';
                document.getElementById('add-form').style.display = 'block';
                document.getElementById('auth-links').innerHTML = `
                    <a href="/dashboard" class="btn btn-outline">–ö–∞–±—ñ–Ω–µ—Ç</a>
                `;
            }
        }

        // Load categories
        async function loadCategories() {
            try {
                const categories = await HAL.api.get('/categories?flat=true');
                const select = document.getElementById('category_id');
                categories.forEach(cat => {
                    const name = HAL.state.language === 'uk' ? cat.nameUk : cat.nameRu;
                    const prefix = cat.parent_id ? '‚Äî ' : '';
                    const option = document.createElement('option');
                    option.value = cat.id;
                    option.textContent = prefix + name;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Failed to load categories:', error);
            }
        }

        // Image upload handling
        const imageUploadArea = document.getElementById('image-upload-area');
        const imageInput = document.getElementById('image-input');

        imageUploadArea.addEventListener('click', () => imageInput.click());
        
        imageUploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            imageUploadArea.classList.add('dragover');
        });
        
        imageUploadArea.addEventListener('dragleave', () => {
            imageUploadArea.classList.remove('dragover');
        });
        
        imageUploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            imageUploadArea.classList.remove('dragover');
            handleFiles(e.dataTransfer.files);
        });

        imageInput.addEventListener('change', (e) => {
            handleFiles(e.target.files);
        });

        function handleFiles(files) {
            const maxFiles = 10 - uploadedImages.length;
            const validFiles = Array.from(files).slice(0, maxFiles);
            
            validFiles.forEach(file => {
                // Check format
                if (!file.name.toLowerCase().endsWith('.webp') && file.type !== 'image/webp') {
                    HAL.showToast(`${file.name}: —Ç—ñ–ª—å–∫–∏ WebP —Ñ–æ—Ä–º–∞—Ç!`, 'error');
                    return;
                }
                
                // Check size (5MB)
                if (file.size > 5 * 1024 * 1024) {
                    HAL.showToast(`${file.name}: —Ñ–∞–π–ª –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫–∏–π (–º–∞–∫—Å. 5–ú–ë)`, 'error');
                    return;
                }
                
                // Add to list
                const reader = new FileReader();
                reader.onload = (e) => {
                    uploadedImages.push({
                        file: file,
                        preview: e.target.result,
                        isMain: uploadedImages.length === 0
                    });
                    renderImages();
                };
                reader.readAsDataURL(file);
            });
        }

        function renderImages() {
            const container = document.getElementById('uploaded-images');
            const counter = document.getElementById('images-count');
            
            if (uploadedImages.length === 0) {
                container.innerHTML = '';
                counter.textContent = '';
                return;
            }
            
            container.innerHTML = uploadedImages.map((img, index) => `
                <div class="uploaded-image ${img.isMain ? 'main' : ''}">
                    <img src="${img.preview}" alt="–§–æ—Ç–æ ${index + 1}">
                    <button type="button" class="remove-btn" onclick="removeImage(${index})">√ó</button>
                </div>
            `).join('');
            
            counter.textContent = `${uploadedImages.length} / 10 –∑–æ–±—Ä–∞–∂–µ–Ω—å`;
        }

        function removeImage(index) {
            const wasMain = uploadedImages[index].isMain;
            uploadedImages.splice(index, 1);
            
            // Set first as main if removed was main
            if (wasMain && uploadedImages.length > 0) {
                uploadedImages[0].isMain = true;
            }
            
            renderImages();
        }

        // SEO character counters
        function setupCharCounter(inputId, counterId, max) {
            const input = document.getElementById(inputId);
            const counter = document.getElementById(counterId);
            
            input.addEventListener('input', () => {
                const len = input.value.length;
                counter.textContent = `${len} / ${max} —Å–∏–º–≤–æ–ª—ñ–≤`;
                counter.className = 'char-counter';
                if (len > max) {
                    counter.classList.add('error');
                } else if (len > max * 0.9) {
                    counter.classList.add('warning');
                }
                
                // Update preview
                updateSeoPreview();
            });
        }

        setupCharCounter('meta_title_uk', 'meta_title_uk_counter', 60);
        setupCharCounter('meta_title_ru', 'meta_title_ru_counter', 60);
        setupCharCounter('meta_description_uk', 'meta_description_uk_counter', 160);
        setupCharCounter('meta_description_ru', 'meta_description_ru_counter', 160);

        function updateSeoPreview() {
            const lang = HAL.state.language;
            const title = document.getElementById(lang === 'uk' ? 'meta_title_uk' : 'meta_title_ru').value || '–ù–∞–∑–≤–∞ –≤–∞—à–æ—ó –∫–æ–º–ø–∞–Ω—ñ—ó';
            const desc = document.getElementById(lang === 'uk' ? 'meta_description_uk' : 'meta_description_ru').value || '–û–ø–∏—Å –≤–∞—à–æ—ó –∫–æ–º–ø–∞–Ω—ñ—ó –∑\'—è–≤–∏—Ç—å—Å—è —Ç—É—Ç...';
            const name = document.getElementById('name').value;
            
            document.getElementById('seo-preview-title').textContent = title + ' - HAL';
            document.getElementById('seo-preview-desc').textContent = desc;
            document.getElementById('seo-preview-url').textContent = name ? name.toLowerCase().replace(/\s+/g, '-').substring(0, 30) : 'your-company';
        }

        // Auto-fill SEO from name
        document.getElementById('name').addEventListener('blur', () => {
            const name = document.getElementById('name').value;
            const city = document.getElementById('city').value;
            
            if (name && !document.getElementById('meta_title_uk').value) {
                document.getElementById('meta_title_uk').value = `${name} - –ø–æ—Å–ª—É–≥–∏ –≤ ${city}`;
                document.getElementById('meta_title_uk').dispatchEvent(new Event('input'));
            }
        });

        document.getElementById('name_ru').addEventListener('blur', () => {
            const name = document.getElementById('name_ru').value;
            const city = document.getElementById('city').value;
            
            if (name && !document.getElementById('meta_title_ru').value) {
                document.getElementById('meta_title_ru').value = `${name} - —É—Å–ª—É–≥–∏ –≤ ${city}`;
                document.getElementById('meta_title_ru').dispatchEvent(new Event('input'));
            }
        });

        document.getElementById('description').addEventListener('blur', () => {
            const desc = document.getElementById('description').value;
            if (desc && !document.getElementById('meta_description_uk').value) {
                document.getElementById('meta_description_uk').value = desc.substring(0, 155) + (desc.length > 155 ? '...' : '');
                document.getElementById('meta_description_uk').dispatchEvent(new Event('input'));
            }
        });

        document.getElementById('description_ru').addEventListener('blur', () => {
            const desc = document.getElementById('description_ru').value;
            if (desc && !document.getElementById('meta_description_ru').value) {
                document.getElementById('meta_description_ru').value = desc.substring(0, 155) + (desc.length > 155 ? '...' : '');
                document.getElementById('meta_description_ru').dispatchEvent(new Event('input'));
            }
        });

        // Submit form
        document.getElementById('add-company-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            // Validate images
            if (uploadedImages.length === 0) {
                HAL.showToast('–î–æ–¥–∞–π—Ç–µ —Ö–æ—á–∞ –± –æ–¥–Ω–µ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è –∫–æ–º–ø–∞–Ω—ñ—ó', 'error');
                return;
            }
            
            const submitBtn = document.getElementById('submit-btn');
            submitBtn.disabled = true;
            submitBtn.textContent = '–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è...';
            
            try {
                // Prepare company data
                const formData = new FormData(e.target);
                const companyData = {};
                formData.forEach((value, key) => {
                    companyData[key] = value;
                });
                
                // Create company
                const result = await HAL.api.post('/companies', companyData);
                const companyId = result.id;
                
                // Upload images
                for (let i = 0; i < uploadedImages.length; i++) {
                    submitBtn.textContent = `–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —Ñ–æ—Ç–æ ${i + 1}/${uploadedImages.length}...`;
                    
                    const imageFormData = new FormData();
                    imageFormData.append('image', uploadedImages[i].file);
                    
                    await fetch(`/api/users/me/companies/${companyId}/images`, {
                        method: 'POST',
                        headers: { 'Authorization': `Bearer ${HAL.state.token}` },
                        body: imageFormData
                    });
                }
                
                HAL.showToast('–ö–æ–º–ø–∞–Ω—ñ—é —É—Å–ø—ñ—à–Ω–æ –¥–æ–¥–∞–Ω–æ!', 'success');
                setTimeout(() => {
                    window.location.href = `/company/${companyId}`;
                }, 1000);
                
            } catch (error) {
                HAL.showToast(error.message || '–ü–æ–º–∏–ª–∫–∞ –¥–æ–¥–∞–≤–∞–Ω–Ω—è –∫–æ–º–ø–∞–Ω—ñ—ó', 'error');
                submitBtn.disabled = false;
                submitBtn.textContent = '‚úì –î–æ–¥–∞—Ç–∏ –∫–æ–º–ø–∞–Ω—ñ—é';
            }
        });

        // Initialize
        checkAuth();
        loadCategories();
    </script>
</body>
</html>
